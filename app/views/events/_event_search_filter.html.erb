<%
	pa = params.dup
	pa.delete(:view)
%>
<% content_for :head do %>
  <% unless params[:id] %>
	<link rel="alternate" type="application/atom+xml" href="<%= url_for(pa.merge(:format => 'atom')).sub(/\?$/,'') %>"/>
  <% end %>
	<link rel="alternate" type="text/calendar" href="<%= url_for(pa.merge(:format => 'ics')).sub(/\?$/,'') %>"/>
<% end %>
<div id="content_header" class="clearfix">

  <% if flash[:notice] %>
    <div class="flash ui-widget">
      <div class="ui-state-highlight ui-corner-all">
        <%= flash[:notice] %>          
      </div>
    </div>
  <% end %>

  <div class="current_event_filtering clearfix">
    <div class="span-11">
      <h2 class="find_an_event">Find an Event in October</h2>
      <h3 class="filter_description"><%= current_filter_description%></h3> 

    </div>

    <ul class="search_subscription_options">
      <!-- <li class="email png">Send me these events as email.</li> -->
    <% unless params[:id] %>
      <li class="calendar"><%= link_to "Add these events to my calendar.", url_for(pa.merge(:format => 'ics')).sub(/\?$/,'') %></li>
      <li class="google_calendar"><%= link_to "Add these events to Google Calendar.", "http://www.google.com/calendar/render?cid="+CGI::escape(url_for(pa.merge(:format => 'ics', :only_path => false)).sub(/\?$/,'')) %></li>
      <li class="rss"><%= link_to "Add to my feed reader.", url_for(pa.merge(:format => 'atom')).sub(/\?$/,'') %></li>
    <% end %>
    
    </ul>
    
  </div>
  
  <div class="event_filtering clearfix">
    <h3 class="toggles"><%= image_tag('buttons/bt_find_events_in_your_area.gif') %></h3>
    <div class="add_event_link">Organising an event in October? <%= link_to "Add it to the calendar here", "#new_event" %></div>

    <div class="form_wrapper">
      <% form_tag current_events_path, :method => :get, :id => "events_filter_form" do %>

        <div class="filter filter_theme clearfix input_with_tip">
          <label for="filter_theme">Area of Interest</label> 
          <%= select_tag "filter[theme]", options_for_select([['Any', ""]]+Event::Themes, params[:filter][:theme]) %>
          <div class="input_tip">
             <div class="tooltip">There are lots of events going on during October. You can use this to select a subject that interests you, or leave it as it is to display everything.</div>
             <div class="tooltip_arrow"></div>
          </div>
        </div>

        <div class="filter_location clearfix filter input_with_tip">
          <label for="filter_location" class="text">Postcode</label>  
          <%= text_field_tag "filter[location]", nil, :class => 'text', :value => params[:filter][:location] %>
          <div class="input_tip">
             <div class="tooltip">Where are you? If you'd like to display events near you, enter your postcode here.</div>
             <div class="tooltip_arrow"></div>
          </div>
        </div>

        <% if params[:view] == 'map' %>
        <div class="date_slider">          <%= hidden_field :filter, "from_day", :value => params[:filter][:from_day] %>
          <%= hidden_field :filter, "to_day",   :value => params[:filter][:to_day] %>
          <div class="slider">
          </div>
          <div class="current_time_span">
            <span class="current_from_day"><%= params[:filter][:from_day] %></span> <%= params[:month] %>
            to
            <span class="current_to_day"><%= params[:filter][:to_day] %></span> <%= params[:month] %>
          </div>
        </div>
        <% end %>

        <%= hidden_field_tag "view", params[:view] %>


        <div class="submit_options clearfix">
          <a href="#events_filter_form" class="cancel_search toggles" id="hides_events_filter_form_wrapper">cancel</a>
          <%= image_submit_tag(filter_check_button_path, :alt => "Search For Events", :class => "search_for_events") %>
        </div>

      <% end %>
    </div>
  </div>
  
</div>
